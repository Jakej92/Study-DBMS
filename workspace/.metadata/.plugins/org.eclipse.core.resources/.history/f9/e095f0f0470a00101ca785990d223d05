/* 피드 전체 조회 */
DROP VIEW VIEW_ALL_REPLY  ;
CREATE VIEW VIEW_FEED AS
SELECT 'GENERAL' AS FEED_TYPE, F.ID, F.FEED_CONTENT, GF.MEMBER_ID, NULL AS REAL_FEED_STAR, NULL AS PLAN_ID, F.CREATE_DATE, F.UPDATE_DATE 
FROM TBL_FEED F
JOIN TBL_GENERAL_FEED GF ON F.ID = GF.ID
UNION ALL
SELECT 'TOGETHER' AS FEED_TYPE, F.ID, F.FEED_CONTENT, TF.MEMBER_ID, NULL AS REAL_FEED_STAR, NULL AS PLAN_ID, F.CREATE_DATE, F.UPDATE_DATE
FROM TBL_FEED F
JOIN TBL_TOGETHER_FEED TF ON F.ID = TF.ID
UNION ALL
SELECT 'REAL' AS FEED_TYPE, F.ID, F.FEED_CONTENT, RF.MEMBER_ID, RF.REAL_FEED_STAR, RF.PLAN_ID, F.CREATE_DATE, F.UPDATE_DATE
FROM TBL_FEED F
JOIN TBL_REAL_FEED RF ON F.ID = RF.ID;

/* 댓글 전체 조회 */

CREATE VIEW VIEW_REPLY AS
(
SELECT 'GENERAL' AS REPLY_TYPE, R.ID, R.REPLY_CONTENT , GR.MEMBER_ID, GR.GENERAL_FEED_ID FEED_ID, R.CREATE_DATE , R.UPDATE_DATE 
FROM TBL_REPLY R
JOIN TBL_GENERAL_REPLY GR ON R.ID = GR.ID
UNION ALL
SELECT 'TOGETHER' AS REPLY_TYPE, R.ID, R.REPLY_CONTENT , TR.MEMBER_ID, TR.TOGETHER_FEED_ID FEED_ID, R.CREATE_DATE , R.UPDATE_DATE 
FROM TBL_REPLY R
JOIN TBL_TOGETHER_REPLY TR ON R.ID = TR.ID
UNION ALL
SELECT 'REAL' AS REPLY_TYPE, R.ID, R.REPLY_CONTENT , RR.MEMBER_ID, RR.REAL_FEED_ID FEED_ID, R.CREATE_DATE , R.UPDATE_DATE 
FROM TBL_REPLY R
JOIN TBL_REAL_REPLY RR ON R.ID = RR.ID
);

/*받은메세지함의 보낸사람*/
CREATE VIEW VIEW_RECEIVE_MESSAGE AS
SELECT 
    rm.ID AS RECEIVE_MESSAGE_ID,
    rm.RECEIVER_ID,
    m.MESSAGE_ALL_CONTENT,
    m.MESSAGE_ALL_DATE,
    rm.SENDER_ID,
    rm.RECEIVE_MESSAGE_CHECK
FROM TBL_RECEIVE_MESSAGE rm
JOIN TBL_MESSAGE m ON rm.ID = m.ID;

SELECT * FROM TBL_MESSAGE;
SELECT * FROM TBL_RECEIVE_MESSAGE;
SELECT * FROM VIEW_SEND_MESSAGE;
SELECT * FROM TBL_MEMBER;

INSERT INTO TBL_MEMBER ID, MEMBER_EMAIL, MEMBER_PASSWORD, MEMBER_NICKNAME, MEMBER_TELL, MEMBER_GENDER
VALUES (SEQ_MEMBER.NEXTVAL, 'jbeaver@gmaill.com', 'qwer', 'JustinBeaver', '01054713250', '남자');

SELECT * FROM TBL_PAY;

SELECT * FROM TBL_PLAN;
SELECT * FROM TBL_ADMIN;
SELECT * FROM TBL_COURSE;
SELECT * FROM TBL_WISH;

SELECT COURSE_TYPE, COURSE_NAME, COURSE_FILE_PATH
FROM (
    SELECT C.COURSE_TYPE, C.COURSE_NAME, C.COURSE_FILE_PATH
    FROM TBL_PARTICIPANT P
    JOIN TBL_PLAN PL ON P.PLAN_ID = PL.ID
    JOIN TBL_COURSE C ON PL.COURSE_ID = C.ID
    WHERE P.MEMBER_ID = 1
    ORDER BY PL.PLAN_END_DATE DESC
) WHERE ROWNUM = 1;


SELECT * FROM TBL_FILE ORDER BY ID DESC;
SELECT * FROM TBL_MEMBER_FILE ORDER BY ID DESC;



UPDATE TBL_MEMBER SET MEMBER_PASSWORD = 1234 WHERE ID = 2;



/*보낸메세지함의 받은사람*/

CREATE VIEW VIEW_SEND_MESSAGE AS
SELECT 
    sm.ID AS SEND_MESSAGE_ID,
    sm.RECEIVER_ID,
    sm.SENDER_ID,
    m.MESSAGE_ALL_CONTENT,
    m.MESSAGE_ALL_DATE
FROM TBL_SEND_MESSAGE sm
JOIN TBL_MESSAGE m ON sm.ID = m.ID;

